/*! angular-sails-bind - v1.0.5 - 2015-05-12
* https://github.com/diegopamio/angular-sails-bind
* Copyright (c) 2015 Diego Pamio; Licensed MIT */
try{angular.module("ngSails"),angular.module("ngSailsBind",["ngSails"])}catch(e){angular.module("ngSailsBind",[]).factory("$sails",function(){return io.socket})}angular.module("ngSailsBind").factory("$sailsBind",["$q","$rootScope","$timeout","$log","$sails",function(a,b,c,d,e){"use strict";function f(f,g,h){function k(a){var b=m(g,q,[]),e={created:function(){return m(g,q,[]).push(a.data),!0},updated:function(){var c=o(b,function(b){return a.id==b.id});return c?(angular.extend(c,a.data),!0):!1},destroyed:function(){var c=o(b,function(b){return a.id==b.id});return c?(b.splice(b.indexOf(c),1),!0):!1}};e[a.verb]?e[a.verb]()&&c(function(){g.$apply()}):d.log("Unknown action »"+a.verb+"«")}function p(){g.$watchCollection(q,function(a,c){var d,h;a=a||[],c=c||[],d=n(a,c),h=n(c,a),h.forEach(function(a){j("/"+r+f+"?id="+a.id).then(function(c){c&&!c.error&&(b.$broadcast(f,{id:a.id,verb:"destroyed",scope:g.$id}),e["delete"]("/"+r+f+"/destroy/"+a.id))})}),d.forEach(function(a){a.id||e.put("/"+r+f+"/create/",a,function(c){j("/"+r+f+"/"+c.id).then(function(c){angular.extend(a,c),b.$broadcast(f,{id:a.id,verb:"created",scope:g.$id,data:angular.copy(a)})})})}),i(d,g,f,r,q)})}var q;angular.isObject(f)?(q=f.hasOwnProperty("scopeProperty")?f.scopeProperty:f.model.split("/").pop()+"s",f.hasOwnProperty("scope")&&(h=g,g=f.scope),f.hasOwnProperty("query")&&(h=f.query),f=f.model):q=f.split("/").pop()+"s";var r=f.split("/");r.length>1?(f=r.splice(r.length-1,1),r=r.join("/")+"/"):r="";var s=new a.defer,t=j("/"+r+f,h);return t.then(function(a){angular.isArray(a)||(a=[a]),l(g,q,a),i(a,g,f,r,q),p(),s.resolve()}),e.on(f,k),g.$on(f,function(a,b){g.$id!=b.scope&&k(b)}),s.promise}function g(a){}function h(a,b){}function i(a,c,d,f,g){a.forEach(function(a){c.$watchCollection(g+"["+m(c,g,[]).indexOf(a)+"]",function(a,g){g&&a&&(angular.equals(g,a)||g.id!=a.id||g.updatedAt!==a.updatedAt||(b.$broadcast(d,{id:g.id,verb:"updated",scope:c.$id,data:angular.extend(angular.copy(a),{updatedAt:(new Date).toISOString()})}),e.post("/"+f+d+"/update/"+g.id,angular.copy(a))))})})}function j(c,d){var f=new a.defer;return d=d||{},e.get(c,d,function(a){b.$apply(f.resolve(a))}),f.promise}function k(){return window.hasOwnProperty("describe")&&window.hasOwnProperty("it")}function l(a,b,c){for(var d=b.split("."),e=a,f=d.pop();d.length;)a[d[0]]=angular.isObject(a[d[0]])||{},e=a[d.shift()];e[f]=c}function m(a,b,c){for(b=angular.isArray(b)?b:b.split(".");b.length&&(a=a[b.shift()]););return void 0===a?c:a}function n(a,b){return a.filter(function(a){return b.indexOf(a)<0})}function o(a,b,c){if("function"!=typeof b)throw new TypeError("predicate must be a function");for(var d,e=Object(a),f=e.length>>>0,g=0;f>g;g++)if(d=e[g],b.call(c,d,g,e))return d;return void 0}var p={bind:f,on:h,save:g};return k()&&(p.setObjectProperty=l,p.getObjectProperty=m),p}]);