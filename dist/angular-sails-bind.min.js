/*! angular-sails-bind - v1.0.5 - 2015-05-15
* https://github.com/diegopamio/angular-sails-bind
* Copyright (c) 2015 Diego Pamio; Licensed MIT */
try{angular.module("ngSails"),angular.module("ngSailsBind",["ngSails"])}catch(e){angular.module("ngSailsBind",[]).factory("$sails",function(){return io.socket})}angular.module("ngSailsBind").factory("$sailsBind",["$q","$rootScope","$timeout","$log","$sails",function(a,b,c,d,e){"use strict";function f(b,c,d){var f=g(b,c,d),i=new a.defer,j=p(f,null);return x(f,j,d).then(function(a){angular.isArray(a)||(a=[a]),D(f.scope,f.scopeProperty,a),v(a,f),l(f),i.resolve()}),e.on(f.model,h.bind(this,f)),f.scope.$on(f.model,function(a,b){f.scope.$id!==b.scope&&h(f,b)}),i.promise}function g(a,b,c){return angular.isObject(a)?(a.hasOwnProperty("scopeProperty")||(a.scopeProperty=a.model.split("/").pop()+"s"),a.hasOwnProperty("scope")||void 0===b||(a.scope=b),a.hasOwnProperty("query")||void 0===c||(c=a.query)):(a={model:a,scopeProperty:a.split("/").pop()+"s",scope:b},void 0!==c&&(a.query=c)),a.prefix=a.model.split("/"),a.length>1?(a.model=a.prefix.splice(a.prefix.length-1,1),a.prefix=a.prefix.join("/")+"/"):a.prefix="",a}function h(a,b){var e=E(a.scope,a.scopeProperty,[]),f={created:i,updated:j,destroyed:k};f[b.verb]?f[b.verb](a,b,e)&&c(function(){a.scope.$apply()}):d.log("Unknown action »"+b.verb+"«")}function i(a,b,c){return E(a.scope,a.scopeProperty,[]).push(b.data),!0}function j(a,b,c){var d=G(c,function(a){return b.id.toString()===a.id.toString()});return d?(angular.extend(d,b.data),!0):!1}function k(a,b,c){var d=G(c,function(a){return b.id.toString()===a.id.toString()});return d?(c.splice(c.indexOf(d),1),!0):!1}function l(a){a.scope.$watchCollection(a.scopeProperty,function(b,c){m(a,b,c)})}function m(a,b,c){b=b||[],c=c||[];var d=F(b,c),e=F(c,b);angular.forEach(e,n.bind(this,a)),angular.forEach(d,o.bind(this,a)),v(d,a)}function n(a,b){var c=p(a,null,b.id);x(a,c).then(function(d){d&&!d.error&&(u(a,A(a,b,"destroyed")),u("change",z("destroyed",a,b)),c=p(a,"destroy",b.id),e["delete"](c,function(d,e){e.error&&(u("error",a,y(e,"delete",c,{})),u(a,A(a,b,"error")))}))})}function o(a,b){if(!b.id){var c=p(a,"create");e.put(c,b,function(d,e){e.error?(u("error",a,y(e,"put",c,b)),u(a,A(a,b,"error"))):(c=p(a,null,d.id),x(a,c).then(function(c){angular.extend(b,c),u("change",z("created",a,b)),u(a,A(a,b,"created",angular.copy(b)))}))})}}function p(a,b,c){var d="/"+a.prefix+a.model;return d+=b?"/"+b+"/":"/",d+=c?"?id="+c:""}function q(){I=angular.copy(J)}function r(a){H(I,a)}function s(a){var b=getBinding(scope,a);b&&m(b.options,b.data,E(b.options.scope,b.scopeProperty))}function t(a,b,c){if(!K.hasOwnProperty(a))throw new Error("Cannot register for event: "+a);K[a].push({callback:b,context:c})}function u(a,c){var d;if(angular.isString(a)){for(var e=[],f=1;f<arguments.length;f++)e.push(arguments[f]);d=w("broadcastType",c).toLowerCase(),K.hasOwnProperty(a)&&angular.forEach(K[a],function(f){f.callback.apply(f.context,e);var g=w("broadcast."+a,c);g!==!0||"simple"!==d&&"both"!==d||b.$broadcast.apply(b,["angularSailsBind."+a].concat(e))})}else if(angular.isObject(a)){var g=c;c=a,a=c.model,d=w("broadcastType",c).toLowerCase();var h=w("broadcast.models."+a,c);("model"===d||"both"===d)&&(h===!0||void 0===h)&&b.$broadcast(a,g)}}function v(a,b){function c(a){var c=E(b.scope,b.scopeProperty,[]).indexOf(a),e=b.scopeProperty+"["+c+"]";b.scope.$watchCollection(e,d)}function d(a,c){if(c&&a&&!angular.equals(c,a)&&c.id===a.id&&c.updatedAt===a.updatedAt){var d=angular.extend(angular.copy(a),{updatedAt:(new Date).toISOString()});u(b,A(b,c,"updated",d)),u("updated",z("updated",b,d));var f=p(b,"update",c.id),g=angular.copy(a);e.post(f,g,function(a,d){d.error&&(u("error",b,y(d,"post",f,g)),u(b,A(b,c,"error")))})}}a.forEach(c)}function w(a,b){return E(b,a,E(I,a))}function x(c,d,f){var g=new a.defer;return f=f||{},e.get(d,f,function(a,e){e.error?(u("error",c,y(e,"get",d,f)),u(c,A(c,"error"))):b.$apply(g.resolve(a))}),g.promise}function y(a,b,c,d){return{target:{src:c,method:b,content:d||{}},type:a.statusCode,message:B(a.statusCode,a.body)}}function z(a,b,c){return{target:{scopeProperty:b.scopeProperty,id:c.id},type:a}}function A(a,b,c,d){var e;return angular.isString(b)?(e={verb:b,scope:a.scope.$id},d=c):e={id:b.id,verb:c,scope:a.scope.$id},void 0!==d&&(e.data=d),e}function B(a,b){return angular.isString(b)?b:L.hasOwnProperty(a)?L[a]:void 0}function C(){var a;try{a=Function("return this")()||(42,eval)("this")}catch(b){a=window}return a.hasOwnProperty("describe")&&a.hasOwnProperty("it")}function D(a,b,c){for(var d=b.split("."),e=a,f=d.pop();d.length;)e[d[0]]=a[d[0]]||{},e=a[d.shift()];e[f]=c}function E(a,b,c){for(b=angular.isArray(b)?b:b.split(".");b.length&&(a=a[b.shift()]););return void 0===a?c:a}function F(a,b){return a.filter(function(a){return b.indexOf(a)<0})}function G(a,b,c){if("function"!=typeof b)throw new TypeError("predicate must be a function");for(var d,e=Object(a),f=e.length>>>0,g=0;f>g;g++)if(d=e[g],b.call(c,d,g,e))return d;return void 0}function H(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])if(arguments[b].hasOwnProperty(c)){if(angular.isObject(arguments[b][c])&&angular.isObject(a[c])){H(a[c],arguments[b][c]);continue}a[c]=arguments[b][c]}return a}var I={autoSave:!0,autoUpdate:!0,broadcast:{error:!1,change:!1,models:{}},broadcastType:"model"},J=angular.copy(I),K={error:[],change:[]},L={400:"Malformed resource request.",401:"Not authorized to access this resource.",402:"Payment required to access this resource.",403:"Access to this resource is forbidden.",404:"Resource not found.",405:"Requests to resource using this method is not allowed.",406:"Cannot send resource in acceptable format.",407:"Proxy authentication required to access this resource.",408:"Request timeout.",409:"There is a conflict in your request, which cannot be resolved by the server.",410:"This resource is no-longer available, please update your client.",500:"Server error",501:"Requested service or feature is not implimented",502:"Could not forward the response through proxy.",503:"Server not available.",504:"Proxy timeout."},M={bind:f,on:t,save:s,config:r,"default":q};return C()&&(M.setObjectProperty=D,M.getObjectProperty=E),M}]);